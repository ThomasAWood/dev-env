#!/bin/bash

SHELL_CONFIG="$HOME/.zshrc"

# Setup nvm in shell config if not already done
if [ -n "$SHELL_CONFIG" ]; then
    if ! grep -q 'NVM_DIR' "$SHELL_CONFIG" 2>/dev/null; then
        echo "Adding nvm configuration to $SHELL_CONFIG..."
        mkdir -p "$HOME/.nvm"
        cat >> "$SHELL_CONFIG" << 'EOF'

# nvm configuration
export NVM_DIR="$HOME/.nvm"
[ -s "/opt/homebrew/opt/nvm/nvm.sh" ] && \. "/opt/homebrew/opt/nvm/nvm.sh"  # This loads nvm
[ -s "/opt/homebrew/opt/nvm/etc/bash_completion.d/nvm" ] && \. "/opt/homebrew/opt/nvm/etc/bash_completion.d/nvm"  # This loads nvm bash_completion
EOF
        echo "nvm configuration added to shell config"
    fi
fi

# Load nvm into current session
export NVM_DIR="$HOME/.nvm"
mkdir -p "$NVM_DIR"

# Try to load nvm from Homebrew location
if [ -s "/opt/homebrew/opt/nvm/nvm.sh" ]; then
    source "/opt/homebrew/opt/nvm/nvm.sh"
elif [ -s "/usr/local/opt/nvm/nvm.sh" ]; then
    source "/usr/local/opt/nvm/nvm.sh"
else
    echo "nvm installation not found. Please restart your terminal and run this script again."
    exit 1
fi

# Install Node.js LTS
echo "Installing Node.js LTS..."
nvm install --lts
nvm use --lts
nvm alias default 'lts/*'
echo "Node.js $(node --version) installed and set as default"
